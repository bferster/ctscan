<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="css/jquery-ui.min.css"></link>
	<script src="lib/jquery.min.js"></script>
	<script src="lib/jquery-ui.min.js"></script>
	<link REL="SHORTCUT ICON" HREF="img/favicon.ico">
	<title>CTScan Data view</title>

	<style type="text/css">
		 
		 body { 			font-family: Verdana,Geneva,sans-serif; font-size:13px; box-sizing: border-box;
							padding: 0px; margin: 0px; 
							}
		.ct-obsPanel {		background-color:#ddd; border-radius: 6px; margin: 24px; padding: 12px; max-width: 1000px;
							margin-left: auto; margin-right: auto; opacity: 1;
							}
		.ct-is 	{			border-radius:4px; padding-left:8px; border: 1px solid #999; margin-bottom: 3px;
							}

		.ct-dialogTitle {	font-size: 20px; font-weight: bold; color: #000; margin-bottom: 8px; user-select: none;
							}

		.ui-dialog-buttonpane.ui-widget-content.ui-helper-clearfix { border:none }
		.ui-dialog { border-radius:6px; background-color:#ddd }
		.ui-button { border-radius:30px;outline:none }
		.ui-dialog-titlebar { display:none }
		 table {			border-spacing: 0px;  }
		 input {		    vertical-align: -2px; }

</style>
</head>
<body>
	<br>
	<div style="margin-left: auto; margin-right: auto;text-align:center;width:800px;" >
		<img src="img/ctlogo400.png" width="100"><br><br>
		<b>Classroom Teaching Scan Data Viewer</b><br>
	</div>
	<div id="obsPanel" class="ct-obsPanel">
		<table style="max-width:1000px;width:100%">	
			<tr style="font-weight:bold"><td>Observer</td><td>Email</td><td>Date</td><td>Session Id</td><td>Teacher</td><tr><tr>
				<tr><td colspan='5'><hr></td></tr>
				<td><select id="viewObs" class="ct-is"><option>All</option></select></td>
				<td><select id="viewEmail" class="ct-is"><option>All</option></select></td>
				<td><select id="viewDate" class="ct-is"><option>All</option></select></td>
				<td><select id="viewSess" class="ct-is"><option>All</option></select></td>
				<td><select id="viewTid" class="ct-is"><option>All</option></select></td></tr>
				<tr><td colspan='5'><hr></td></tr>
		</table>
		</div>


<script>

//////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN 
/////////////////////////////////////////////////////////////////////////////////////////////////
			
$(document).ready(function() {								           	// ON PAGE LOADED
	var str="SELECT DISTINCT d2 FROM `events` WHERE d1 = 'ObserverName' ORDER BY d2"
	Query(str, function(d) { 											// Send query
		var i;
		d=$.parseJSON(d);												// Objectify result
		for (i=0;i<d.length;++i)										// For each one
			$("#viewObs").append("<option>"+d[i].d2+"</option>");		// Add to select
		});
	var str="SELECT DISTINCT d2 FROM `events` WHERE d1 = 'ObserverEmail' ORDER BY d2"
	Query(str, function(d) { 											// Send query
		var i;
		d=$.parseJSON(d);												// Objectify result
		for (i=0;i<d.length;++i)										// For each one
			$("#viewEmail").append("<option>"+d[i].d2+"</option>");		// Add to select
		});
	var str="SELECT DISTINCT d2 FROM `events` WHERE d1 = 'Date' ORDER BY d2 DESC"
	Query(str, function(d) { 											// Send query
		var i;
		d=$.parseJSON(d);												// Objectify result
		for (i=0;i<d.length;++i)										// For each one
			$("#viewDate").append("<option>"+d[i].d2+"</option>");		// Add to select
		$('#viewDate option:eq(1)').prop('selected', true);				// Highlight first one
	});
	var str="SELECT DISTINCT d2 FROM `events` WHERE d1 = 'TeacherID' ORDER BY d2"
	Query(str, function(d) { 											// Send query
		var i;
		d=$.parseJSON(d);												// Objectify result
		for (i=0;i<d.length;++i)										// For each one
			$("#viewTid").append("<option>"+d[i].d2+"</option>");		// Add to select
		});
	var str="SELECT DISTINCT obsId FROM `events` WHERE d1 != '' ORDER BY obsId"
	Query(str, function(d) { 											// Send query
		var i;
		d=$.parseJSON(d);												// Objectify result
		for (i=0;i<d.length;++i)										// For each one
			$("#viewSess").append("<option>"+d[i].obsId+"</option>");	// Add to select
		});

	});		

	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// HELPERS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	function Query(query, callback) 
	{
		var dat={ q:query.replace(/'/g,"~") };
		var url="//classroomteachingscan.com/ctscan/query.php";				// Target

		$.ajax({ url:url,dataType:'text',type:"GET",crossDomain:true,data:dat,  // Get data
			success:function(d) { callback(d) },							// Run callback				
			error:function(xhr,status,error) { trace(error) },				// Show error
			});		
	}
		
	function DialogBox(title, content, callback, callback2) 	// DIALOG BOX
	{
		$("#dialogDiv").remove();												
		$("body").append("<div class='unselectable' id='dialogDiv'></div>");														
		var str="<p><img src='img/ctlogo32.png' style='vertical-align:-8px'/>&nbsp;&nbsp;";								
		str+="<span class='ct-dialogTitle'>"+title+"</span><p>";
		str+="<div style='font-size:12px;margin:14px'>"+content+"</div>";
		$("#dialogDiv").append(str);	
		$("#dialogDiv").dialog({ width:$("#obsPanel").width()+16, height:$("#obsPanel").height()+24, 
								 buttons: {
					            	"OK": 		function() { if (callback)
					            								callback(); 
					            								$("#dialogDiv").animate({ opacity:0},200, function() {	
																	$("#dialogDiv").remove();  
																	});
					            								},
					            	"Cancel":  	function() { if (callback2)	            		
					            								callback2();
				            									$("#dialogDiv").animate({ opacity:0},200, function() {		
																	$("#dialogDiv").remove();  
																	});
																}
									}});	
		$("#dialogDiv").dialog("option","position",{ my:"left top", at:"left top", of:obsPanel });
	}

	function GetTextBox(title, content, def, callback)					// GET TEXT LINE BOX
	{
		$("#alertBoxDiv").remove();											// Remove any old ones
		$("body").append("<div class='qm-unselectable' id='alertBoxDiv'></div>");														
		var str="<p><img src='img/ctlogo32.png' style='vertical-align:-8px'/>&nbsp;&nbsp;";								
		str+="<span class='ct-dialogTitle'>"+title+"</span><p>";
		str+="<div style='font-size:12px;margin:14px'>"+content+"</div>";
		str+="<p><input class='qm-is' type='text' id='gtBoxTt' value='"+def+"'></p></div>";
		$("#alertBoxDiv").append(str);	
		$("#alertBoxDiv").dialog({ width:300, buttons: {
					            	"OK": 		function() { callback($("#gtBoxTt").val()); $(this).remove(); },
					            	"Cancel":  	function() { $(this).remove(); }
									}});	
		}

	function trace(msg, p1, p2, p3, p4)										// CONSOLE 
	{
		if (p4 != undefined)
			console.log(msg,p1,p2,p3,p4);
		else if (p3 != undefined)
			console.log(msg,p1,p2,p3);
		else if (p2 != undefined)
			console.log(msg,p1,p2);
		else if (p1 != undefined)
			console.log(msg,p1);
		else
			console.log(msg);
	}

	function ShortenString(str, len)									// SHORTEN A STRING TO LENGTH
	{
		if (str && str.length > len)										// Too long
			str=str.substr(0,(len-3)/2)+"..."+str.slice((len-3)/-2);		// Shorten	
		return str;															// Return string
	}

	function Sound(sound, mute)												// PLAY SOUND
	{
		var snd=new Audio();													// Init audio object
		if (!snd.canPlayType("audio/mpeg") || (snd.canPlayType("audio/mpeg") == "maybe")) 
			snd=new Audio("img/"+sound+".ogg");									// Use ogg
		else	
			snd=new Audio("img/"+sound+".mp3");									// Use mp3
		if (!mute)	{															// If not initing or muting	
			snd.volume=50/100;													// Set volume
			snd.play();															// Play it
			}
		}

	function SetCookie(cname, cvalue, exdays)								// SET COOKIE
	{
		var d=new Date();
		d.setTime(d.getTime()+(exdays*24*60*60*1000));
		var expires = "expires="+d.toGMTString();
		document.cookie = cname + "=" + cvalue + "; " + expires;
	}
	
	function GetCookie(cname) 												// GET COOKIE
	{
		var name=cname+"=",c;
		var ca=document.cookie.split(';');
		for (var i=0;i<ca.length;i++)  {
		  c=ca[i].trim();
		  if (c.indexOf(name) == 0) 
		  	return c.substring(name.length,c.length);
		  }
		return "";
	}
	function MakeUniqueId()													// MAKE UNIQUE ID
	{
		var i,index;
		var ts=+new Date;														// Get date
		var id=ts.toString();													// Strt with timstamp				
		var parts=id.split("").reverse();										// Mix them up
		var n=parts.length-1;													// Max
		var s=id.length;														// Start digit
		for(i=s;i<s+8;++i) {													// Add 8 random digits
			index=Math.floor(Math.random()*n);									// Get index
			id+=parts[index];													// Add to id 
			}
		return ""+id;															// Return unique id	as string													
	}
		
</script>
</body>
</html>
